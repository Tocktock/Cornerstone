{% extends "base.html" %}
{% import 'macros/ui.html' as ui %}
{% block title %}Search · Cornerstone{% endblock %}

{% block navigation %}
  {{ ui.navigation('search') }}
{% endblock %}
{% block content %}
  <div class="surface-card px-6 py-8 sm:px-10">
    <div class="flex flex-col gap-6">
      <header>
        <h1 class="text-2xl font-semibold text-slate-900">Cornerstone Semantic Search</h1>
        <p class="mt-2 text-sm text-slate-600">Search across project-specific knowledge bases with embedded vectors.</p>
      </header>
      <form method="post" action="/search" class="flex flex-col gap-4 sm:flex-row sm:items-end">
        <label class="flex w-full flex-col gap-2 text-sm font-semibold text-slate-700 sm:max-w-xs">
          <span>Project</span>
          <select
            name="project_id"
            aria-label="Select project"
            class="w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-medium text-slate-700 shadow-sm transition focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/30"
          >
            {% for project in projects %}
              <option value="{{ project.id }}" {% if project.id == selected_project %}selected{% endif %}>{{ project.name }}</option>
            {% endfor %}
          </select>
        </label>
        <label class="flex w-full flex-col gap-2 text-sm font-semibold text-slate-700">
          <span>Query</span>
          <input
            type="text"
            name="query"
            placeholder="Enter a query…"
            value="{{ query | default('') }}"
            required
            class="w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-base shadow-sm transition focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/30"
          />
        </label>
        <button type="submit" class="btn-primary self-start sm:self-auto">Search</button>
      </form>

      {% if results is defined %}
        {% if results %}
          <section class="space-y-4">
            <h2 class="text-lg font-semibold text-slate-900">Results</h2>
            <ul class="space-y-3">
              {% for item in results %}
                <li class="rounded-2xl border border-slate-200 bg-white px-5 py-4 shadow-sm">
                  <p class="text-sm text-slate-800">{{ item.payload.get("text", item.payload) }}</p>
                  <p class="mt-2 text-xs font-medium text-slate-500">Score: {{ '%.4f'|format(item.score | float) }}</p>
                </li>
              {% endfor %}
            </ul>
          </section>
        {% else %}
          <p class="rounded-xl border border-dashed border-slate-200 bg-slate-50 px-5 py-4 text-sm text-slate-600">
            No results found for this project.
          </p>
        {% endif %}
      {% endif %}
    </div>
  </div>
{% endblock %}
